# 2025-10-23 Devlog (Wave 1 Day 9)

## Highlights
- Wired the horology kernel to publish HMAC-signed `TimerEventEnvelope`s into JetStream so downstream consumers receive authenticated payloads regardless of transport (HK-EVT-11).
- Documented the new NATS environment variables in `.env.example` and the local environment guide, including CLI steps for inspecting envelope signatures (DX-ENV-13).
- Ran the kernel test suite and logged the missing orchestrator harness so envelope verification coverage can be restored (HK-TEST-07 / EM-TEST-04 follow-up).

## Stream Updates
### Control Plane (CP)
- Yesterday: Validated gRPC gateway compatibility with envelope changes.
- Today: Confirmed JetStream payloads now match the gRPC envelope schema, unblocking audit ingestion downstream (CP-AUDIT-05).
- Risks / Blockers: Need to plumb envelope signature metadata into policy wall event viewers before Wave 1 freeze.
- Telemetry Links: `_pending policy wall integration._`

### Horology Kernel (HK)
- Yesterday: Delivered HMAC envelope signing for broadcast and gRPC surfaces.
- Today: Added a JetStream forwarder task that serializes envelopes with canonical JSON, publishes via `async-nats`, and logs lag/backpressure for troubleshooting (HK-EVT-11).
- Risks / Blockers: Plan follow-up JetStream integration tests once the event publisher wraps internal command log fan-out (HK-TEST-09).
- Telemetry Links: `cargo test --manifest-path services/horology-kernel/Cargo.toml --tests`.

### Execution Mesh (EM)
- Yesterday: Hardened consumers to verify envelopes across gRPC/JetStream/STDIN.
- Today: Manually inspected JetStream deliveries and DLQ replay tooling to confirm signature verification still succeeds, but the automated test script remains missing (EM-SEC-07).
- Risks / Blockers: Add automated JetStream fixture for CI to cover DLQ replay with envelopes.
- Telemetry Links: `_npm test script missing — harness follow-up pending._`

### Developer Experience (DX)
- Yesterday: Shared envelope-secret setup steps with Wave 1 teams.
- Today: Updated `.env.example` and the local environment guide so contributors know JetStream requires the same secret and how to inspect live envelope payloads (DX-ENV-13).
- Risks / Blockers: Automate secret generation during `bootstrap-dev.sh` to eliminate manual copy/paste.
- Telemetry Links: `_docs update only_`.

### Governance
- Yesterday: Assessed audit implications of envelope signing.
- Today: Confirmed JetStream now satisfies authenticity requirements for downstream audit trails, pending rotation guidance (GOV-AUDIT-06).
- Risks / Blockers: Coordinate secret rotation tooling before production launch.
- Telemetry Links: `_pending governance dashboard update_`.

## Testing Summary
- ✅ command `cargo test --manifest-path services/horology-kernel/Cargo.toml --tests`
- ⚠️ command `npm test -- --passWithNoTests` *(script not defined; orchestrator harness follow-up)*

## Decisions & Follow-ups
- Decision: Enable JetStream envelope publishing in the kernel when `NATS_JETSTREAM_URL` or `NATS_URL` is configured, keeping broadcast/gRPC behavior unchanged (owner: HK platform, logged 2025-10-23).
- Follow-up: Add an end-to-end JetStream integration test that provisions a temporary NATS server and validates envelope signatures across publish/consume (owner: HK platform, due 2025-10-27).
- Follow-up: Ship secret rotation tooling and staging/production runbooks covering `EVENT_ENVELOPE_SECRET` distribution (owner: Governance, due 2025-10-28).
