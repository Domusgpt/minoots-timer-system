# 2025-10-18 Devlog (Wave 1 Day 4)

## Highlights
- Landed a Postgres-backed kernel restore test that proves timers survive process restarts (HK-PERSIST-01).
- Added `TEST_DATABASE_URL` plumbing to the shared environment guide so contributors can run the new persistence suite.
- Coordinated across streams on remaining persistence + telemetry hooks now that durable restore is validated.

## Stream Updates
### Control Plane (CP)
- Yesterday: Monitoring kernel-side persistence work to align REST error handling for follower responses.
- Today: Drafted follow-up to surface `retryAfterMs` hints via gRPC once kernel exposes leader telemetry (CP-POLICY-09).
- Risks / Blockers: Awaiting kernel telemetry wiring before REST gateway can emit richer retry hints.
- Telemetry Links: _(pending once OTEL spans flow through the persistence tests)._ 

### Horology Kernel (HK)
- Yesterday: HTTP Raft supervisor shipped with multi-node failover coverage.
- Today: Implemented a Postgres restore integration test that seeds `timer_records`, boots the kernel, and observes `Fired`/`Settled` events post-restart (HK-PERSIST-01).
- Risks / Blockers: Need to replace the OpenRaft `MemStore` with a durable backend before enabling clustered mode in production (HK-RAFT-05).
- Telemetry Links: `cargo test --manifest-path services/horology-kernel/Cargo.toml` (local run w/ Postgres).

### Execution Mesh (EM)
- Yesterday: Standing by for durable kernel events to back JetStream replay work.
- Today: Reviewed restore output to ensure orchestrator can safely assume `Settled` emits after restarts (EM-BUS-05).
- Risks / Blockers: JetStream consumer changes still pending the kernel's durable event stream.
- Telemetry Links: _(pending once JetStream harness lands)._ 

### Developer Experience (DX)
- Yesterday: Preparing docs for OpenRaft toggle path.
- Today: Updated `docs/devx/LOCAL_ENVIRONMENT.md` with `TEST_DATABASE_URL` guidance and test commands so contributors can run persistence suites without guesswork (DX-ENV-08).
- Risks / Blockers: Need to automate `.env` hydration in the devcontainer so `TEST_DATABASE_URL` is pre-populated.
- Telemetry Links: Reference `cargo test` output from HK stream.

### Governance
- Yesterday: Tracking need for persisted election audit trails.
- Today: Logged a follow-up to emit command-log trace IDs once the durable store is hooked to OTEL (GOV-AUDIT-04).
- Risks / Blockers: Command log events currently lack OTEL spans; needs instrumentation pass.
- Telemetry Links: _(pending)._ 

## Testing Summary
- âœ… command `cargo test --manifest-path services/horology-kernel/Cargo.toml`

## Decisions & Follow-ups
- Decision: Treat Postgres restore coverage as the gating criterion for replacing the in-memory Raft store (owner: HK lead, logged 2025-10-18).
- Follow-up: Instrument the Postgres command log + restore path with OTEL spans before enabling CI enforcement (owners: HK & DX leads, due 2025-10-22).
- Follow-up: Automate `.env` scaffolding for `TEST_DATABASE_URL` in devcontainers to reduce onboarding friction (owner: DX lead, due 2025-10-24).
