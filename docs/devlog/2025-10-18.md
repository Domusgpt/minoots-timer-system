# 2025-10-18 Devlog (Wave 1 Day 4)

## Highlights
- Delivered the multi-kernel failover harness that boots two Postgres-backed kernel binaries, enforces single-leader semantics, and asserts follower takeover after SIGINT-triggered failover.
- Shipped a ready-to-import Grafana dashboard for coordinator metrics alongside a Honeycomb/Grafana Cloud OTEL collector profile so teams can visualise election churn immediately.
- Extended the local environment guide and npm scripts to make both the Phase 1 harness and failover drill one-command operations with consistent cleanup.

## Stream Updates
### Control Plane (CP)
- Yesterday: Harness coverage stopped at simulated follower gateways.
- Today: Added documentation for invoking the failover harness and noted the log prefixes developers should expect while monitoring leadership transitions.
- Risks / Blockers: Need CI runners with Postgres + Rust toolchain to automate both harnesses (CP-INT-07).
- Telemetry Links: Harness output from `npm run test:phase1:failover` shows follower `FAILED_PRECONDITION` then successful takeover scheduling.

### Horology Kernel (HK)
- Yesterday: Postgres coordinator metrics existed but lacked dashboards or real multi-node validation.
- Today: Failover harness validates advisory-lock leadership end-to-end; Grafana dashboard (`infrastructure/grafana/dashboards/kernel-coordinator.json`) charts election attempts/results, transitions, and heartbeat outcomes per node.
- Risks / Blockers: Need automated metric assertions post-failover and eventual OpenRaft supervisor wiring (HK-OBS-05).
- Telemetry Links: Import the dashboard and hit `curl http://localhost:9464/metrics | grep kernel_coordinator` during the harness run.

### Execution Mesh (EM)
- Yesterday: No changes since webhook hardening.
- Today: Observed timer fire events only indirectly via kernel scheduling; orchestrator hooks unchanged.
- Risks / Blockers: Still pending leader-aware subscriptions and DLQ replay automation in CI (EM-BUS-04).
- Telemetry Links: NATS DLQ replay script unchanged (`services/action-orchestrator/scripts/replay-dead-letter.js`).

### Developer Experience (DX)
- Yesterday: Local guide covered telemetry scraping but not failover drills or Grafana assets.
- Today: Documented failover harness invocation, linked the Grafana dashboard and OTEL collector profile, and exposed npm helpers for quick execution.
- Risks / Blockers: Need to bake both harnesses into `scripts/smoke-infra.sh` once runtime cost is acceptable (DX-OPS-06).
- Telemetry Links: `docs/devx/LOCAL_ENVIRONMENT.md` Section 8 for failover steps.

### Governance
- Yesterday: Leadership transitions lacked persistent audit surfaces.
- Today: Harness cleanup truncates `kernel_raft_state`, preparing for future audit ledger insertion; Grafana panels give interim monitoring for compliance teams.
- Risks / Blockers: Still must persist leadership changes to immutable audit trails (GOV-AUDIT-02).
- Telemetry Links: Grafana panel "Leadership Transitions" surfaces churn per node.

## Testing Summary
- ✅ command `cargo test --manifest-path services/horology-kernel/Cargo.toml -- --test-threads=1`
- ✅ command `npm test -- --passWithNoTests`
- ✅ command `npm run build`
- ✅ command `npm run test:phase1:failover`
- ✅ command `node scripts/check-devlog-entry.js`

## Decisions & Follow-ups
- Decision: Codified `npm run test:phase1:failover` as the canonical multi-kernel drill, keeping the ts-node preload for shared module resolution (owner: HK/DX pairing, logged 2025-10-18).
- Follow-up: Integrate both harnesses into CI once Docker-based Postgres service is available (owner: Platform Eng, due 2025-10-24).
- Follow-up: Extend the failover harness to scrape `/metrics` after takeover and assert election counters increment (owner: Observability guild, due 2025-10-23).
- Follow-up: Replace the Postgres coordinator with the OpenRaft supervisor once log replication lands, updating harness logic accordingly (owner: HK team, due 2025-11-05).
