# 2025-10-20 Devlog (Wave 1 Day 6)

## Highlights
- Replaced the OpenRaft in-memory store with a Postgres-backed adapter so leadership votes, logs, and state machine snapshots persist across kernel restarts (HK-RAFT-07).
- Added a dedicated migration for `kernel_raft_log`/`kernel_raft_metadata` and updated the local environment guide so contributors can inspect Raft state durably (DX-ENV-10).
- Landed a storage round-trip test that exercises the new adapter via `TEST_DATABASE_URL`, keeping Wave 1 persistence coverage green (HK-TEST-05).

## Stream Updates
### Control Plane (CP)
- Yesterday: Monitoring kernel restart flows while keeping policy wall changes staged.
- Today: No direct code changes; confirmed the gateway continues to surface `Retry-After` hints when the kernel defers to the new raft-backed leader handle (CP-POLICY-10).
- Risks / Blockers: Need OTEL spans from the raft adapter before exposing richer leader election metrics to the gateway.
- Telemetry Links: _(pending once raft spans land)._ 

### Horology Kernel (HK)
- Yesterday: Command log restart harness covered timer + lifecycle recovery but leadership state still lived in-memory.
- Today: Introduced `replication::postgres_store::PostgresBackedStore`, wired it into `RaftSupervisor`, and verified votes/logs/state machine survive process restarts (HK-RAFT-07).
- Risks / Blockers: Chaos drills (DB outage, jitter) still outstanding before enabling clustered mode in CI.
- Telemetry Links: `cargo test --manifest-path services/horology-kernel/Cargo.toml --tests`.

### Execution Mesh (EM)
- Yesterday: Awaiting durable leadership signals to correlate orchestrator behaviour with kernel failover.
- Today: No changes; ready to consume raft metadata once OTEL spans expose the leader timeline (EM-OBS-06).
- Risks / Blockers: Without spans, DLQ replay tooling still lacks leadership context.
- Telemetry Links: _(pending)._ 

### Developer Experience (DX)
- Yesterday: Documented command log inspection for restart validation.
- Today: Extended the local environment guide with raft inspection queries and noted the new migration in the bootstrap script (DX-ENV-10).
- Risks / Blockers: Devcontainer still needs automatic Postgres seeding for `TEST_DATABASE_URL`.
- Telemetry Links: `cargo fmt --manifest-path services/horology-kernel/Cargo.toml`.

### Governance
- Yesterday: Tracking the need for durable leadership audit trails.
- Today: Logged that the postgres-backed raft store now captures votes/commits, unblocking OTEL span work for audit ingestion (GOV-AUDIT-05).
- Risks / Blockers: Audit automation still depends on observability wiring around the new adapter.
- Telemetry Links: _(pending)._ 

## Testing Summary
- ✅ command `cargo fmt --manifest-path services/horology-kernel/Cargo.toml`
- ✅ command `cargo test --manifest-path services/horology-kernel/Cargo.toml --tests`

## Decisions & Follow-ups
- Decision: Promote the Postgres raft adapter to default whenever the kernel boots with a pool (owner: HK lead, logged 2025-10-20).
- Follow-up: Instrument raft persistence operations with OTEL spans and propagate trace IDs to the control plane (owner: HK observability, due 2025-10-23).
- Follow-up: Run chaos drills (DB outage, heartbeat jitter) against the postgres-backed supervisor before enabling CI enforcement (owner: HK reliability, due 2025-10-25).
